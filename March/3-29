非连续内存分配    分段 分页 页表
连续缺点  分配给一个程序的物理内存连续 内存利用率较低 外碎片/内碎片
非连续优点    物理地址非连续 更好利用内存/管理   共享代码和数据  支持动态加载动态链接
缺点  如何建立虚拟地址-物理地址转换  软件开销大 硬件  分段 分页
分段  程序的分段地址空间  分段寻址方案
主程序 子程序    分段 更好的分离 共享
分散到多个物理地址空间
硬件方式：分段寻址方案    段访问机制 一个段 一个内存块 一个逻辑地址空间     程序访问内存地址需要 一个二维二元组 段号 段内偏移
单地址实现    段寄存器+地址寄存器实现     段表

分页地址空间  页寻址方案
段/页区别  段的尺寸可变 页的帧固定    物理内存固定大小  逻辑地址空间至相同大小的页   page逻辑页  帧物理页     转换逻辑地址    页表  MMU/TLB
帧 物理内存组织方式    framenumber    f帧号 F位2^F个帧  o帧内偏移 s位每帧2^s个字节
页 逻辑地址空间划分为大小相同的页    页内偏移=帧内偏移   p  o 类似帧
页寻址机制  页映射到帧 连续虚拟内存 帧是非连续物理内存 不是所有的页都有对应的帧

页表   
大数组 索引pagenumber 存帧号    每个运行程序都有一个列表 属于程序运行状态 动态变化  PTBR页表基址寄存器
空间代价 时间开销
访问一个内存单元需要2次内存访问  一次获取页表项 一次访问数据
页表可能非常大  64位机器每页1024字节 一个页表大小    通过缓存caching  间接访问indirection访问
TLB快表 Translation look-aside buffer
时间TLB缓存cache 页表中内容   key p   value f     关联内存实现 快速访问性能   TLB命中直接获得页号 未命中对应表项更新到TLB中
局部性（尽可能访问一块区域防止TLB缺失）
驻留位0 映射关系不存在
多级页表 把页号分为k各部分实现多级间接页表
时间换空间  TLB缓解时间

反向页表  大地址空间问题 前向映射页表繁琐     页表与物理地址空间的大小相对应   逻辑地址空间增长速度快于物理地址
页帧号索引 页号内容   限制数量
使用页寄存器 每个帧和一个寄存器关联
利  表的大小相对物理内存很小 与逻辑地址大小无关    弊 信息对调 帧号找页号   怎样转换  需要在反向页表搜索想要页号
关联内存不能太大
如果帧数较少 页寄存器可以被放置在关联内存中  关联内存中查找逻辑页号 成功帧号提取 失败错误异常   限制因素 大量关联内存昂贵 难以在单个时钟周期完成 耗电
哈希查找
硬件加速 pid运行程序id   算出帧号    id能环节冲突
哈希碰撞   拿到内存开销较大   TLB机制    不受制逻辑地址 空间可以很小     整个系统只需一个
告诉哈希计算  高效哈希函数  冲突解决机制


虚拟内存起因 覆盖技术 交换技术 虚存技术
理想中的存储器  更大更快 更便宜 非易失性   cache缓存内存数据
硬盘速度  主存 硬盘 磁带
多道程序运行环境  手动覆盖 自动交换 自动的虚拟存储技术

覆盖技术  较小的可用内存中运行较大程序 用于多道程序 与分区存储管理配合使用
把程序按逻辑结构分类 划分成相对独立的程序模块 不会同时执行的模块共享一块内存区域 按时间先后运行
常用功能代码及数据常驻内存 不常用部分在其他程序模块中实现平时存放在外存需要时装入内存 不存在调用关系的模块不必同时装入到内存从而相互覆盖
分时方式共享内存空间      缺点 开销     程序员需要进行设计 确定各个模块覆盖关系     从外装入内存 用时间换空间

交换技术  多道程序在内存时让正在运行的程序或需要运行的程序获得更多内存资源     可将暂时不能运行程序送到外存  把一个进程的地址空间内容保存到外存 将外存某个进程的的地址空间读入到内存中 内容大小为程序地址空间
何时交换  内存空间不够或有不够的危险时换出      交换区大小 必须足够大以存放所有用户进程的所有内存映像的拷贝 必须能对这些内存映像进行直接存取    重定位 换出后再换入 最好采用动态地址映射
覆盖与交换比较  覆盖只能发生在相互间没有调用关系的程序模块之间 程序员必须给出程序内各个模块之间的逻辑覆盖结构    交换技术是以在内存中程序大小为单位进行 不需要程序员给出各个模块间逻辑覆盖结构 交换发生在内存中程序与管理程序/操作系统间 覆盖发生在运行程序内部

虚存技术--目标
内存不够用的情形下 可采用覆盖/交换技术  覆盖技术需要程序员操作   交换技术以进程作为交换单位增加了处理器的开销
虚存技术  像覆盖技术那样不是把程序的所有内容都放在内存中 可以运行更大的程序 无需程序员干涉 操作系统自动完成       像交换技术那样 实现进程在内存外存间交换 获得更多空闲内存空间 只对进程部分内容在内存外存进行交换
程序的局部性原理  程序在执行过程中一个较短时期 所执行的指令地址和指令的操作数地址分别局限于一定区域      时间局部性  较短时期     空间局部性  集中在较小区域内
编写方法对缺页率的影响
装入程序时不将其全部装入内存 只将当前需要执行的部分页面或段装入内存     程序执行时 数据/指令尚未在内存中 处理器通知操作系统将相应页面或段调入内存继续执行程序        操作系统将内存暂时不使用的页面/段调出保存在外存上 从而腾出更多空闲空间存放程序/页面/段
基本特征   大的用户空间 物理内存外村相结合 提供给用户的虚拟内存空间通常大于实际物理内存 实现分离 32位虚拟地址理论上可以访问4G 可能计算机只有256M物理内存 但硬盘容量大于4G
                 部分交换  与交换技术相比 虚拟存储的调入和调出是对部分虚拟地址空间进行的
                 不连续性   物理内存分配的不连续性 虚拟地址空间使用的不连续
页式内存管理  页表完成逻辑页到物理页帧的映射

虚拟页式内存管理  大部分虚拟系统都采用虚拟页式存储管理技术 在页式存储管理上增加请求调页和页面置换功能
当一个用户程序调入内存时 不是将该程序所有页面装入内存 只装入部分页面      运行过程如果发现程序/数据不在内存则向系统发出缺页中断请求 系统处理这个中断时将外存相应页面调入内存 使程序能继续运行
驻留位 1标识在内存中 0代表在外存中 如果访问则导致缺页中断     保护位 允许对该页做任何类型访问 制度 可读写 可执行等     修改位 在内存中是否被修改过 根据此位决定是否将它的内容写回外存     访问位 页面被访问过设置 用于页面置换算法
缺页中断
后备存储  能简单识别二级存储器的页 交换空间(特殊格式存储未被映射的页)       
虚拟地址空间的页面可以被映射到一个文件中的某个位置    代码段 映射到可执行二进制文件     动态加载的共享库程序段 映射到动态调用的库文件     其他段 可能被映射到交换文件
EAT有效存储器访问时间   访存时间*页表命中几率+缺页处理时间*缺页几率
