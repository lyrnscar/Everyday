9.网络层下
路由算法
确定目的网络的最佳路径  转发表确定在路由器中如何转发分组
网络抽象 图   节点 路由     边 链路
费用     关键问题 源到目的最小费用路径
路由算法分类：静态路由（手工配置 路由更新慢 优先级高）动态路由（路由更新快（定期更新|及时响应费用变化））
                       全局信息 所有路由器掌握完整拓扑和链路费用 LS链路状态路由算法       分散信息  路由器只掌握物理相连的邻居及链路费用  信息交换迭代运算    距离向量DV路由算法

链路状态路由算法
Dijkstra算法 所有结点掌握网络拓扑和链路费用（通过链路状态广播 所有节点信息相同）  计算从一个节点到其他所有节点最短路径   迭代k次
符号 c节点x到y链路费用   D(v)当前费用值   p(v)当前路径   N已找到最小费用路径的节点集合
复杂性 O(n2)  高效实现O(nlogn)
存在震荡可能（链路费用是该链路承载通信量） 随即延迟信息避免

距离向量路由算法
本质是动态规划 Bellman Ford
dx(y) 从x到y最短路径的费用（距离）   = min{c(x,y)+dv(y)}
重点：结点获得最短路径下一跳
核心思想：不定时将自身Dv估计发送给邻居    x收到邻居估计时，根据B-F更新自身距离向量估计   最终收敛于实际的最小费用
异步迭代   引发每次局部迭代因素 （局部链路费用改变 来自邻居Dv更新）           分布式   每个结点只当Dv变化时才通告给邻居     
每个结点  等待  重新计算 如果Dv到达任意目的距离发生变化通知所有邻居
类似Floyd算法
链路费用变化：检测本地链路费用变化 更新路由信息重新计算距离向量 如果改变通告所有邻居
好消息传播快
无穷记数问题     坏消息传播慢   存在环路（互相假象）      毒性逆转（通告给该邻居结点到达目的距离为无穷大）
定义一个最大有效费用值（从而不会真无穷）

层次路由（路由策略）
将任意规模网络抽象为一个图过于理想化  表示所有路由器 ‘扁平’网络  实际网络不可行       网络规模：6亿结点无法存储   信息交换量巨大淹没链路          管理自治：每个网络的管理都期望自主控制  互连网=网络之网络
聚合路由器为一个区域：自治系统AS  同一AS路由器运行相同的路由协议（自治系统内部路由协议）不同自治系统内的路由器可以运行不同的AS内部路由协议      网关路由器：位于AS边缘 通过链路连接其他AS的网关路由器
转发表由AS内部路由算法与AS间路由算法共同配置
自治系统间路由任务
AS间选择：热土豆路由：将分组发送给最近的网关路由器

RIP协议
AS内部路由 internet采用层次路由    也称IGP协议内部网络协议     RIP路由信息协议  OSPF开放最短路径优先  IGRP内部网关路由协议
RIP 1982发布   距离向量路由算法（距离度量 跳步数15     每隔30s邻居交换一次DV称为通告    每次通告最多25个目的子网）
链路失效 恢复   如果180s没有收到通告 邻居/链路失效   经过该邻居的路由不可用 向邻居发送新通告 邻居再依次向外发通告 链路失效信息能否快速传播到全网（无穷级数）   毒性逆转技术预防乒乓环路
路由表处理  利用乘坐route-d应用层进程实现  通告报文周期性通过UDP数据报发送

OSPF协议
开放：公众可用   采用链路状态路由算法（LS分组扩散 每个路由器构造完整的网络拓扑图 利用dijkstra算法） OSPF通告中每个入口对应一个邻居  通告在整个AS范围泛洪（直接封装到IP数据报）    与IS-IS路由协议相似
优点RIP没有：安全（所有报文可以被认证 预防而已入侵）   允许多条相同费用的路径   对每条链路可针对不同TOS设置不同的费用度量 尽力设置低 针对实时ToS高）  继承单播路由多播路由（多播与单薄利用相同网络拓扑数据）   支持大规模AS分层
分层：局部区 主干区     区边界路由器（同时是某个区又是主干区） 主干路由器    AS边界路由器

BGP协议
AS间路由协议  边界网关协议  事实上的标准域间路由协议 将Internet粘合成一个整体  为每个AS提供了一种手段 eBGP iBGP      获取传播可达性信息，确定好路径      容许子网向其余部分通告自身存在
BGP会话 两个Peers交换BGP报文   通告去往不同目的前缀的路径  报文交换基于半永久TCP连接         BGP报文：OPEN报文与peer建立tcp连接并认证发送方   UPDATE通告新路径/撤销原路径   KEEPALIVE无update时保活连接也用于对open的确认  NOTIFICATION报告先前差错也被用于关闭连接
通告前缀时 承诺可以将数据报转发给该子网 在通告中会聚合网络前缀
分发路径信息：eBGP会话发送  路由器新增该前缀入口
路径属性：通告前缀信息包括BGP属性  两个重要属性AS-PATH包含前缀通告所经过的AS序列     NEXT-HOP下一跳开始一个AS-PATH路由器接口指向下一跳
网关路由器收到路由通告后，利用输入策略接受/拒绝路由  基于策略      路由器可能获知到达某目的的AS的多条路由   基于本地偏好值属性（策略决策）最短AS-PATH 最近NEXT-HOP路由器（热土豆路由）    附加准则
提供商网络  客户网络  桩网络  双宿网络            不做没有收益的事  只为客户提供路由

为什么采用不同的AS内与AS间路由协议
策略：inter-AS期望管理控制流量如何被路由 谁路由经过其网络   intra-AS单一管理无需策略
规模：层次路由节省路由表大小 减少路由更新流量 适应大规模互联网
性能：intra侧重性能   inter侧重主导
