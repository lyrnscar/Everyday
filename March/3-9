7.网络层上
发送主机像接收数据传送数据段 发送主机：封装数据报   接受主机：向传输层交付数据报     每个主机路由器都运行网络层协议  路由器检验所有穿越它的IP数据报的头部域
核心功能-转发与路由
转发：将分组从路由器的输入端口转移到合适的输出端口   转发表确定路由器如何转发分组
路由：确定分组从源到目的地经过的路径  路由算法确定通过网络的端到端路径
连接建立  某些网络重要功能  数据分组传输前需要首先建立虚拟/逻辑连接    网络层连接与传输层连接
网络层服务模型：internet 尽力服务best effort        ATM（异步传输网络） CBR（电路仿真）/VBR/ABR（可用比特率）/UBR
无连接服务：不事先为系列分组的传输确定传输路径 每个分组独立确定传输路径 不同分组可能传输路径不同    数据报网络
连接服务：从源到目的确定路径 沿传输系列分组 系列分组传输路径相同 传输结束拆除链接                             虚电路网络

数据报网络/虚电路网络  两类典型分组交换网络    主机到主机服务  网络核心实现
虚电路：从源主机到目的主机类似于电路的路径（逻辑连接）  分组交换 每个分组传输利用链路的全部带宽  源到目的路径经过的网络层设备共同完成虚电路功能
通信过程：呼叫建立 数据传输 拆除呼叫    每个分组携带VCID而不是目的主机地址    虚电路经过的每个网络设备都需要维护连接状态    可以面向VC进行预分配
VC具体实现  每条虚电路包括  1从源主机到目的主机的一条路径  2虚电路号VCID沿路每段链路一个编号  3沿路每个网络层设备利用转发表记录经过的每条虚电路
分组携带对应VCID而不是目的地址  同一条VC中间的VCID可能不同
虚电路信令协议 用于VC建立维护与拆除 应用于虚电路网络 目前的Internet不采用

数据报网络
网络层无连接 每个分组携带目的地址 路由器根据分组目的地址转发分组（转发表，检索，每个分组独立选路）
路由算法确定通过网络的端到端路径  转发表确定在本路由如何转发分组
32位   40多亿Ip地址   列表地址范围（聚合转发表入口）   越具体越好   最长前缀匹配优先（检索转发表，优选最长入口）
对比：Internet                       ATM
        计算机间数据交换（弹性）                                       电话网络演化   
        链路类型众多（特点性能各异，统一服务困难）        核心业务是实施对话（严格时间可靠性，有保障服务）
        智能端系统（自适应，性能控制，差错恢复）            哑端系统（非智能）电话机传真机
        简化网络 复杂边缘                                                   简化边缘 复杂网络

Internet网络层 主机、路由器网络层主要功能：路由协议 路径选择 RIP OSPF BGP   转发表    IP协议 寻址规约 数据报格式 分组处理规约             ICMP协议 差错报告 路由器信令
IP数据报格式  首部|数据   
版本号4bit  首部长度4位（4字节为单位）     服务类型8bit  总长度16bit（首部+数据）
标识16位（表示一个IP分组                               标志位3位（保留|DF|MF）   片偏移13位（原IP分组数据相对偏移量）（8字节为单位）
TTL生存时间8位（跳步数）                  协议占8位     首部校验和16位（置全0）（逐跳检验）
源Ip 目的Ip地址各占32位
选项字段1-40B 安全、源选路径、时间戳、路由记录                填充字段0-3B补齐32位对齐保证首部长度是4字节

IP分片
最大传输单元MTU  链路层数据帧可封装数据上限   大IP分组向较小链路转发时，可以被分片   1个分为多片 到达目的主机后重组    相关字段用于标识分片及确定顺序

IP编址  IP分组 源地址 目的地址     接口：实现网络层功能 路由器多个接口 主机通常只有1个或2个
32比特 点分十进制 标识主机路由器接口   IP地址与每个接口关联
子网    网络号-高位比特   主机号-低位比特             IP地址具有相同网络号的设备接口  不跨越路由器可以彼此物理联通

有类IP地址
有类编址 二分法  0A类地址8位网络号  10B类地址16位网络号   110C类地址24位网络号     多播1110D          保留1111E
全0作为源地址 不可以作为目的地址只能表示本机
主机特定值 作为目的地址表示本网内某个特定主机
全1本网 作为目的地址 广播地址
网络号特定值主机号全0 表示一个网络
网络号特定值主机号全1 作为目的地址 直接广播地址 对特定网络上所有主机进行广播
127  非全0非全1    目的/源    本地软件环回测试
私有IP地址  A10 1个     B172.16-172.31 16个   C192.168.0-192.168.255  256个

IP子网划分与子网掩码
IP地址 网络号|子网号|主机号    子网掩码形如IP地址 点分十进制   取值对应网络，子网位全取1 主机位全取0
子网掩码应用，将IP地址与子网掩码按位与运算 提取子网地址
最左子网地址 最右广播地址
