5.4聚类算法对比评估
5.4.1用真实值评估聚类
有一些指标，如调整rand指数（ari）和归一化互信息（nmi）二者可以评估相对于真实聚类的结果，其最佳值为1，0表示不相关聚类（ari可以取负）
使用ari比较三种算法，为作对比添加将点随机分配到两个簇中的图像
在two_moons数据集上比较三种算法，kmeans 0.5，层次聚类0.61，DBSCAN 1.0
用该方式评估聚类时，一个常见错误是使用accuracy_score而不是adjusted_rand_score#normalized_mutual_info_score或其他聚类指标，使用精度的问题在于它要求分配的簇标签与真实值完全匹配，但簇标签本身无意义，唯一重要的是哪些点位于同一个簇中

5.4.2在没有真实值的情况下评估聚类
在实践中，应用聚类算法时，通常没有真实值来比较结果，如果有数据的正确聚类，那么可以使用这一信息构建一个监督模型，如分类器
因此使用ari等指标仅有助于开发算法，对评估应用是否成功无帮助
轮廓系数等聚类评分指标不需要真实值，但在实践中效果不好
轮廓系数计算一个簇的紧致度，值越大越好，最高分数为1，虽然紧致的簇很好，但紧致度不允许复杂形状
利用轮廓系数比较三种聚类算法，k均值轮廓系数最高，尽管DBSCAN的结果最好
对评估聚类，稍好的策略是使用基于鲁棒性的聚类指标，这种指标先向数据中添加一些噪声，或者使用不同的参数然后运行，比较结果
思想是：如果许多算法参数和许多数据扰动返回相同的结果，那么它很可能是可信的，有待后续实现

即使我们得到一个鲁棒性很好的聚类或轮廓系数非常高，但仍不知道聚类的任何语义含义，或者聚类是否反映了数据中我们感兴趣的某个方面
在人脸图像的例子中，我们可能想得到男人和女人，老人和年轻人，或者有胡子的人和没胡子的人，但算法有可能给出侧视图和正面视图，白天或者夜晚拍摄的照片，iphone或安卓拍摄的照片
要想知道聚类的结果是否对应我们感兴趣的内容，唯一的方式是对簇进行人工分析

5.4.3在人脸数据集上比较算法
在人脸数据集上应用，由包含100个成分的pca组成，相对于原始像素，这种表示对人脸图像的语义更强

在原始数据上不用pca，直接使用dbscan分析人脸数据集，看到所有返回的标签都是-1，即都被标记为噪声
改进方式：
1.增大eps，从而扩展每个点的领域
2.减小min_samples，从而将更小的点组视为簇
仅考虑三个点的情况也都是噪声，因此我们需要增大eps，增大至15后，得到了单一簇和噪声点，可以利用这一结果找出噪声相对其他数据的形状，进一步查看有多少点是噪声，有多少点在簇内
噪声只有27个，查看所有噪声点，有的在喝水，有的有一些奇怪的角度，有的图像里有一只手
这种尝试找到奇怪的那一个为异常值检测，在现实情况下，我们可能会尝试更好裁切图像，但是帽子，喝水等图像是实际存在的问题
设置eps至15和0.5之间，对eps为7时，我们得到许多噪声点和许多较小簇，为9时，我们得到许多噪声点，一个较大簇和一些较小簇，为11时仅得到一个较大簇和噪声，较大簇没超过一个，最多有一个较大簇包含多数点，还有一些较小的簇，这说明数据中没有两类或三类非常不同的人脸图像，而是所有图像或多或少与其他图像都具有相似度（或不相似度）
eps7的结果中比较13个较小簇，有一些簇对应不同的人，每个簇中，人脸方向和表情也是固定的，有些簇中包含多少人面孔，但他们表情方向都相似
对数据进行人工分析，不同于监督学习中基于r^2分数或精度的更为自动化的搜索方法

应用dbscan无法创建多于一个较大的簇，凝聚聚类，k均值更可能创建一个均匀的簇，我们需要设置簇的目标个数，将簇的数量设置为数据集中已知人数，虽然无监督聚类算法不太可能完全找到，可以设置一个较小的簇的数量，比如10个，便于分析每个簇

k均值将数据划分为大小相似的簇，大小在64和386之间，与dbscan结果不同
通过将簇中心可视化进一步分析k均值结果，由于我们在pca生成的表示中聚类，因此我们需要使用pca.inverse_transform将簇中心旋转回原始空间并可视化
k均值找到的簇中心是非常平滑的人脸，因为每个簇中心都是64到386张人脸的平均，使用降维pca，可以增加图像的平滑度
聚类似乎捕捉到人脸的不同方向表情以及是否有衬衫领子
给出5个最典型图像（距簇中心最近）和5个最不典型图像
第三个簇是笑脸，也证实了其他簇中方向的重要性，不过非典型的点与簇中心不太相似，分配似乎有些随意
这是由于k均值对所有数据点进行划分，不像dbscan具有噪声点的概念
更多簇可以找到更细微区别，但更多簇会使人工检查更加困难

直接使用层次聚类ward，凝聚聚类生成的也是大小相近的簇，大小在26和623间，这比k均值生成的簇更不均匀，但比dbscan均匀，可以通过计算ari度量凝聚聚类和k均值给出的两种数据划分是否相似
ari仅有0.3，说明labels_agg和labels_km这两种聚类共同点很少
原因在于对于k均值，远离簇中心的点看起来并无共同点

绘制树状图，限制图中树的深度，如果分支到2063，则图像过密无法阅读，对于人脸数据，两个或三个簇就可以很好划分数据，没有非常自然的切割点，有一些分支代表更不同的组，没有特别合适的簇的数量，dbscan试图将所有点聚类在一起
将10个簇可视化，在凝聚聚类中没有簇中心的概念（虽然我们计算平均值），我们只是给出了每个簇的前几个点以及每个簇中点的数量
某些簇虽然有语义上的主题，但许多簇太大实际上很难均匀，这次使用40个簇，挑选出一些特别有趣的簇
10 深色皮肤且微笑26
13 有领子的衬衫11
19 微笑的女性31
22 萨达姆8
36 高额头21
进一步分析可以使用树状图找到高度相似的簇

整个第三章的内容说明聚类的应用和评估是一个非常定性的过程，通常在数据探索阶段很有帮助
三种聚类方法都可以控制聚类粒度，k均值和凝聚聚类允许指定想要的簇的数量，DBSCAN允许用eps参数定义接近程度，从而间接影响簇的大小，三种方法都可以应用于大型数据集，易理解，且可聚类成多个簇
k均值可以用簇的平均值表示簇，也可以看作一种分解方法，每个数据点由簇中心表示
DBSCAN可以检测到没有分配任何簇的噪声点，也可以帮助自动判断簇的数量，与其他两种方法不同，它允许簇具有复杂的形状，如two_moons那样。它有时会生成大小差别很大的簇，可能是优点也可能是缺点
凝聚聚类可以提供数据的可能划分的整个层次结构，可以通过树状图可视化

找到数据的正确表示对监督学习或无监督学习都非常重要，预处理和分解在准备过程非常重要
分解，流形学习和聚类都是加深数据理解的重要工具，没有监督信息的情况下也是理解数据的仅有方法
在监督学习中探索性工具也很重要，通常来说很难量化无监督算法的有用性，但这不影响利用它们理解数据
